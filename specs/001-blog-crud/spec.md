# 功能規格：部落格文章管理系統

**功能分支**：`001-blog-crud`  
**建立日期**：2025-11-16  
**狀態**：草稿  
**輸入**：使用者描述：「部落格功能：CRUD文章（Markdown格式）、標籤管理、日期排序與分類側邊欄」

## 使用者情境與測試 *(必要)*

### 使用者故事 1 - 建立與編輯文章（優先級：P1）

作為部落格作者，我需要能夠建立新文章並以 Markdown 格式撰寫內容，以便快速產出結構化的文章。建立文章時系統會自動記錄建立時間，讓我可以追蹤文章的發布順序。

**為何此優先級**：這是部落格的核心功能。沒有建立文章的能力，整個系統就無法運作。這是 MVP 的基礎。

**獨立測試**：可透過「建立一篇新文章並儲存」來完整測試，並交付「能夠撰寫和儲存 Markdown 格式文章」的價值。

**驗收情境**：

1. **當** 作者在編輯介面輸入 Markdown 格式的文章內容，**並且** 儲存文章，**則** 系統應保存文章內容並自動記錄當前時間作為建立時間
2. **當** 作者編輯現有文章並修改內容，**並且** 儲存變更，**則** 系統應更新文章內容並保持原始建立時間不變
3. **當** 作者在 Markdown 編輯器中使用標準語法（標題、粗體、斜體、清單、程式碼區塊等），**並且** 儲存文章，**則** 系統應正確保存所有 Markdown 語法
4. **當** 作者嘗試建立空白文章（無標題或內容），**則** 系統應提示錯誤訊息要求提供必要資訊

---

### 使用者故事 2 - 瀏覽文章列表（優先級：P2）

作為部落格讀者，我需要能夠看到按日期排序的文章列表（最新的在最前面），以便快速找到最近發布的內容。

**為何此優先級**：這是讀者的主要進入點。有了 P1 的建立功能後，需要一個方式讓讀者看到這些文章。這是第二個必要的功能來形成完整的閱讀體驗。

**獨立測試**：可透過「瀏覽首頁查看文章列表」來完整測試，並交付「讀者可以發現和瀏覽文章」的價值。

**驗收情境**：

1. **當** 讀者進入部落格首頁，**則** 系統應顯示所有已發布文章的列表，依建立時間由新到舊排序
2. **當** 讀者查看文章列表中的某篇文章，**則** 系統應顯示文章標題、建立日期和摘要資訊
3. **當** 讀者點擊列表中的某篇文章，**則** 系統應導航到該文章的完整內容頁面
4. **當** 文章列表為空（無任何文章），**則** 系統應顯示友善的提示訊息（例如：「尚無文章」）

---

### 使用者故事 3 - 檢視文章內容（優先級：P3）

作為部落格讀者，我需要能夠看到文章的完整內容，並且 Markdown 格式能正確渲染為視覺化的排版，以便舒適地閱讀文章。

**為何此優先級**：這完成了基本的閱讀體驗。有了 P1（建立）和 P2（列表）後，需要能夠實際閱讀文章內容。

**獨立測試**：可透過「點擊文章並閱讀完整內容」來完整測試，並交付「讀者可以閱讀格式化的文章」的價值。

**驗收情境**：

1. **當** 讀者開啟某篇文章，**則** 系統應將 Markdown 格式的內容渲染為 HTML 並正確顯示所有格式（標題、粗體、斜體、清單、程式碼區塊等）
2. **當** 文章包含程式碼區塊，**則** 系統應使用等寬字體並保持適當的縮排顯示
3. **當** 文章包含連結或圖片，**則** 系統應正確渲染為可點擊的超連結和可見的圖片
4. **當** 讀者查看文章頁面，**則** 系統應同時顯示文章建立日期

---

### 使用者故事 4 - 標籤管理（優先級：P4）

作為部落格作者，我需要能夠為每篇文章添加一個或多個標籤，以便組織和分類文章內容。

**為何此優先級**：這是內容組織功能。在基本的 CRUD（P1-P3）完成後，標籤功能讓文章更容易管理和發現。

**獨立測試**：可透過「為文章添加標籤並儲存」來完整測試，並交付「文章可以被分類」的價值。

**驗收情境**：

1. **當** 作者建立或編輯文章時，**則** 系統應提供介面讓作者添加一個或多個標籤
2. **當** 作者為文章添加標籤並儲存，**則** 系統應將標籤與文章關聯並保存
3. **當** 作者為文章移除某個標籤，**則** 系統應移除該關聯但保留文章和其他標籤
4. **當** 作者輸入新的標籤名稱，**則** 系統應允許建立新標籤（不限於既有標籤清單）
5. **當** 文章沒有任何標籤，**則** 系統應允許儲存（標籤為選填項目）

---

### 使用者故事 5 - 分類側邊欄（優先級：P5）

作為部落格讀者，我需要能夠在側邊欄看到所有文章的分類（標籤），並點擊某個分類查看該分類下的所有文章，以便快速找到特定主題的內容。

**為何此優先級**：這是進階的導航功能。需要 P4（標籤管理）完成後才有意義。提供更好的內容探索體驗。

**獨立測試**：可透過「點擊側邊欄的某個分類標籤」來完整測試，並交付「讀者可以按主題瀏覽文章」的價值。

**驗收情境**：

1. **當** 讀者瀏覽部落格任何頁面，**則** 側邊欄應顯示所有已使用的標籤清單
2. **當** 讀者查看側邊欄的標籤清單，**則** 每個標籤旁應顯示該標籤下的文章數量
3. **當** 讀者點擊側邊欄中的某個標籤，**則** 系統應顯示所有包含該標籤的文章列表
4. **當** 某個標籤沒有任何文章，**則** 該標籤不應出現在側邊欄中
5. **當** 讀者在標籤篩選頁面查看文章列表，**則** 文章列表應同樣按建立日期由新到舊排序

---

### 使用者故事 6 - 刪除文章（優先級：P6）

作為部落格作者，我需要能夠刪除不再需要的文章，以便維護部落格內容的品質和相關性。

**為何此優先級**：這完成了完整的 CRUD 功能。雖然重要，但在初期階段優先級較低，因為可以透過不顯示文章來暫時達到類似效果。

**獨立測試**：可透過「刪除一篇文章」來完整測試，並交付「作者可以移除不需要的內容」的價值。

**驗收情境**：

1. **當** 作者在文章編輯頁面選擇刪除功能，**則** 系統應顯示確認對話框以防止誤刪
2. **當** 作者確認刪除文章，**則** 系統應永久移除該文章及其所有關聯資料
3. **當** 文章被刪除後，**則** 該文章不應再出現在任何文章列表或搜尋結果中
4. **當** 刪除的文章是某個標籤下的唯一文章，**則** 該標籤應從側邊欄中移除

---

### 邊界情況

- **當文章標題或內容包含特殊字元（如 `<script>`、SQL 指令等）時**，系統應正確轉義以防止安全漏洞
- **當同時有多位作者編輯同一篇文章時**，系統應如何處理衝突？（假設：最後儲存者覆蓋，並在未來版本考慮樂觀鎖定）
- **當 Markdown 內容包含無效或惡意的語法時**，系統應安全地渲染或顯示錯誤提示
- **當文章數量非常大（例如超過 1000 篇）時**，列表頁面應如何分頁以維持效能？（假設：採用分頁機制，每頁顯示 20 篇文章）
- **當標籤名稱包含空格、特殊字元或過長時**，系統應如何處理？（假設：允許空格和常見標點，限制長度為 50 字元）
- **當使用者的網路連線中斷或儲存失敗時**，系統應保留編輯中的內容並提供重試機制

## 需求 *(必要)*

### 功能需求

**文章管理**
- **FR-001**：系統必須允許作者建立新文章，包含標題和 Markdown 格式的內容
- **FR-002**：系統必須在建立文章時自動記錄當前時間作為文章的建立時間戳記
- **FR-003**：系統必須允許作者編輯現有文章的標題和內容
- **FR-004**：系統必須在編輯文章時保持原始建立時間不變
- **FR-005**：系統必須允許作者刪除文章，並在刪除前顯示確認提示
- **FR-006**：系統必須持久化儲存所有文章資料（標題、內容、建立時間、標籤）

**Markdown 處理**
- **FR-007**：系統必須在編輯模式下保留文章的原始 Markdown 格式
- **FR-008**：系統必須在顯示模式下將 Markdown 格式渲染為 HTML
- **FR-009**：系統必須支援標準 Markdown 語法，包括：標題（h1-h6）、粗體、斜體、清單（有序/無序）、連結、圖片、程式碼區塊、引用
- **FR-010**：系統必須對使用者輸入的 Markdown 內容進行安全處理，防止 XSS 攻擊

**標籤系統**
- **FR-011**：系統必須允許作者為每篇文章添加零個或多個標籤
- **FR-012**：系統必須允許作者在編輯文章時新增、移除標籤
- **FR-013**：系統必須支援建立新標籤（作者可輸入不存在的標籤名稱）
- **FR-014**：系統必須將標籤與文章的關聯關係持久化儲存
- **FR-015**：系統必須在刪除文章時同時移除該文章與標籤的關聯

**文章列表與顯示**
- **FR-016**：系統必須提供文章列表頁面，顯示所有已發布的文章
- **FR-017**：系統必須將文章列表依建立時間由新到舊排序（預設排序）
- **FR-018**：系統必須在列表中顯示每篇文章的標題、建立日期和摘要資訊
- **FR-019**：系統必須提供文章詳細頁面，顯示文章的完整內容（渲染後的 HTML）
- **FR-020**：系統必須在文章詳細頁面顯示文章的建立日期和關聯的標籤

**分類側邊欄**
- **FR-021**：系統必須在側邊欄顯示所有目前使用中的標籤清單
- **FR-022**：系統必須在側邊欄的每個標籤旁顯示該標籤關聯的文章數量
- **FR-023**：系統必須在側邊欄排除沒有任何關聯文章的標籤
- **FR-024**：系統必須允許讀者點擊側邊欄中的標籤以篩選該標籤下的文章
- **FR-025**：系統必須在標籤篩選頁面顯示所有包含該標籤的文章，並依建立時間排序

**驗證與錯誤處理**
- **FR-026**：系統必須驗證文章標題不為空白
- **FR-027**：系統必須在儲存失敗時顯示明確的錯誤訊息給使用者
- **FR-028**：系統必須在文章列表為空時顯示友善的提示訊息

### 關鍵實體

- **文章（Article）**：代表部落格的一篇文章。關鍵屬性包括：唯一識別碼、標題、Markdown 格式的內容、建立時間戳記。與標籤實體為多對多關係。

- **標籤（Tag）**：代表文章的分類標籤。關鍵屬性包括：唯一識別碼、標籤名稱。與文章實體為多對多關係。一個標籤可以關聯多篇文章，一篇文章可以有多個標籤。

- **文章-標籤關聯（Article-Tag Association）**：代表文章與標籤之間的多對多關聯關係。關鍵屬性包括：文章識別碼、標籤識別碼。

## 成功標準 *(必要)*

### 可衡量成果

**效能指標**
- **SC-001**：文章列表頁面必須在 3 秒內完成載入（符合憲章效能要求）
- **SC-002**：文章詳細頁面（包含 Markdown 渲染）必須在 2 秒內完成載入
- **SC-003**：側邊欄標籤清單的渲染時間不得超過 1 秒
- **SC-004**：系統必須能夠處理至少 500 篇文章而不出現明顯的效能退化

**使用者體驗指標**
- **SC-005**：作者能在 5 分鐘內完成一篇包含標題、內容和至少一個標籤的文章建立
- **SC-006**：讀者能在 3 次點擊內從首頁找到並開啟任何想閱讀的文章
- **SC-007**：90% 的 Markdown 語法元素（標題、清單、程式碼等）能正確渲染並顯示
- **SC-008**：側邊欄標籤篩選功能能讓讀者在 2 次點擊內找到特定分類的文章

**內容完整性指標**
- **SC-009**：所有儲存的文章內容（包含特殊字元）必須能完整保留並正確顯示
- **SC-010**：文章建立時間必須精確到秒，並在所有顯示位置保持一致
- **SC-011**：文章與標籤的關聯必須 100% 準確（不會遺失或錯誤關聯）

**可用性指標**
- **SC-012**：介面必須符合 WCAG 2.1 Level AA 無障礙標準（符合憲章要求）
- **SC-013**：所有頁面必須在行動裝置（320px 寬度）、平板（768px）和桌面（1024px+）上完全功能
- **SC-014**：錯誤訊息必須清晰易懂，讓使用者能立即理解問題並知道如何修正

**安全性指標**
- **SC-015**：系統必須能防止所有已知的 XSS 攻擊向量（通過 Markdown 內容注入）
- **SC-016**：特殊字元和 HTML 標籤必須被正確轉義，不會破壞頁面結構或執行惡意程式碼

## 介面設計與使用者體驗

### 佈局結構

**最大寬度限制**
- **UI-001**：整體頁面內容（包含 navbar、主內容區、側邊欄）必須限制在 1280px 最大寬度內
- **UI-002**：所有主要容器必須水平置中對齊
- **UI-003**：Navbar 必須採用 `max-w-[1280px]` 並置中
- **UI-004**：主內容區與側邊欄必須包含在同一個 1280px 容器內

**響應式佈局**
- **UI-005**：桌面版（≥1024px）：主內容區使用彈性寬度（flex-1），側邊欄固定 256px（w-64）
- **UI-006**：平板及以下（<1024px）：隱藏側邊欄，改用下拉式選單顯示標籤
- **UI-007**：手機版（<640px）：提供固定浮動按鈕用於快速撰寫文章

**導航列 (Navbar)**
- **UI-008**：Navbar 必須固定在頁面頂部（sticky top-0）
- **UI-009**：Navbar 必須包含：Logo/首頁連結、新增文章按鈕、暗色模式切換按鈕、行動版選單按鈕
- **UI-010**：Navbar 背景必須有邊框分隔（border-b）並支援暗色模式

**側邊欄設計**
- **UI-011**：側邊欄必須顯示在頁面右側（桌面版）
- **UI-012**：側邊欄必須包含：標題「標籤分類」、所有使用中標籤列表、文章數量徽章、「所有文章」按鈕
- **UI-013**：側邊欄使用 sticky 定位（top-20）跟隨頁面滾動
- **UI-014**：側邊欄必須有圓角（rounded-lg）和邊框樣式
- **UI-015**：當前選中的標籤必須以藍色背景高亮顯示

### 文章列表設計

**卡片式佈局**
- **UI-016**：文章必須以大區塊卡片形式垂直堆疊顯示（非多欄網格）
- **UI-017**：每個文章卡片必須包含：標題（text-3xl）、發布日期（含日曆圖標）、標籤徽章、摘要（4行）、繼續閱讀按鈕、閱讀時間估算
- **UI-018**：文章卡片必須有圓角（rounded-xl）、邊框、陰影效果（hover 時加強）
- **UI-019**：文章卡片內邊距必須為 p-8

**標題與元信息**
- **UI-020**：文章標題必須使用大字體（text-3xl font-bold）
- **UI-021**：標題必須可點擊，懸停時變藍色
- **UI-022**：發布日期格式為中文友善格式（例：2024年11月17日）
- **UI-023**：發布日期必須使用語義化 `<time>` 標籤

**標籤顯示**
- **UI-024**：標籤必須以藍色圓角徽章形式顯示（bg-blue-50 dark:bg-blue-900/30）
- **UI-025**：標籤必須可點擊跳轉至該標籤的文章列表頁
- **UI-026**：標籤徽章前必須顯示標籤圖標
- **UI-027**：支援多標籤同時顯示

**摘要與操作**
- **UI-028**：摘要文字必須限制在 4 行（line-clamp-4）
- **UI-029**：摘要使用 text-base 字體，顏色為 text-gray-700 dark:text-gray-300
- **UI-030**：繼續閱讀按鈕必須為藍色（bg-blue-600）配白色文字
- **UI-031**：繼續閱讀按鈕必須包含右箭頭圖標，懸停時向右移動
- **UI-032**：閱讀時間估算必須顯示在卡片底部（基於 350 字/分鐘計算）

**分頁功能**
- **UI-033**：每頁顯示 10 篇文章
- **UI-034**：分頁控制必須包含：上一頁、頁碼按鈕（最多5個）、下一頁
- **UI-035**：當前頁碼必須以藍色背景高亮顯示
- **UI-036**：翻頁時必須自動滾動至頁面頂部

### 暗色模式

**暗色模式支援**
- **UI-037**：系統必須支援淺色/暗色模式切換
- **UI-038**：暗色模式偏好必須儲存至 localStorage
- **UI-039**：首次載入時必須檢測系統偏好（prefers-color-scheme）
- **UI-040**：所有元件必須完整支援暗色模式樣式
- **UI-041**：暗色模式切換按鈕必須顯示對應圖標（太陽/月亮）

**鍵盤快捷鍵**
- **UI-042**：Ctrl/Cmd + K：切換暗色模式
- **UI-043**：Ctrl/Cmd + N：開啟新文章編輯頁
- **UI-044**：Escape：關閉行動版側邊欄

### 載入狀態與錯誤處理

**載入指示器**
- **UI-045**：文章列表載入時必須顯示旋轉動畫和文字提示
- **UI-046**：側邊欄標籤載入時必須顯示骨架屏（3個灰色條）
- **UI-047**：所有載入狀態必須在 3 秒內完成或顯示錯誤

**錯誤提示**
- **UI-048**：錯誤訊息必須使用紅色系配色（bg-red-50 border-red-200）
- **UI-049**：錯誤訊息必須包含圖標、標題、詳細說明、重試按鈕
- **UI-050**：空狀態（無文章）必須顯示圖標、提示文字、建立文章 CTA 按鈕

**確認對話框**
- **UI-051**：刪除操作必須使用可重用的 ConfirmDialog 元件
- **UI-052**：確認對話框必須使用 Teleport 渲染至 body
- **UI-053**：確認對話框必須包含 ARIA 屬性（role、aria-labelledby、aria-describedby）
- **UI-054**：危險操作（刪除）的確認按鈕必須使用紅色
- **UI-055**：確認對話框支援載入狀態（顯示 spinner）

### 無障礙設計

**ARIA 標籤**
- **UI-056**：所有互動元素必須有適當的 ARIA 標籤
- **UI-057**：時間顯示必須使用 `<time datetime="">` 標籤
- **UI-058**：側邊欄標籤必須包裝在 `<nav>` 語義化標籤中

**鍵盤導航**
- **UI-059**：所有可點擊元素必須支援鍵盤 Tab 導航
- **UI-060**：確認對話框必須支援 Enter（確認）和 Escape（取消）
- **UI-061**：焦點必須在對話框開啟時自動移至對話框

### 視覺設計細節

**顏色系統**
- **UI-062**：主色調：藍色 (blue-600/blue-700)
- **UI-063**：背景：白色/深灰 (white/gray-950)
- **UI-064**：文字：深灰/白色 (gray-900/white)
- **UI-065**：邊框：淺灰 (gray-200/gray-800)

**動畫效果**
- **UI-066**：按鈕懸停必須有 transition 過渡效果
- **UI-067**：卡片懸停必須加強陰影（shadow-sm → shadow-lg）
- **UI-068**：繼續閱讀按鈕的箭頭圖標必須有向右移動動畫
- **UI-069**：頁面切換必須有平滑滾動（smooth scroll）

**間距與排版**
- **UI-070**：主內容區上下必須有 py-8 間距
- **UI-071**：文章卡片之間必須有 space-y-6 間距
- **UI-072**：主內容與側邊欄之間必須有 gap-8 間距
- **UI-073**：所有容器必須有響應式 padding（px-4 sm:px-6 lg:px-8）
